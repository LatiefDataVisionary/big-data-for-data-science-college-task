graph LR
    %% ======================================================================
    %% Global Style Definitions
    %% ======================================================================
    %% -- Node & Text Styling --
    classDef default fill:#FFFFFF,stroke:#424242,stroke-width:2px,color:#212121;
    classDef nodeTitle font-size:16px,font-weight:bold,fill:transparent,stroke:none;
    classDef nodeDetail color:#616161,font-size:12px;
    classDef nodeIcon font-size:28px;

    %% -- Phase-Specific Node Colors --
    classDef dsNode fill:#E3F2FD,stroke:#1E88E5;
    classDef ingestNode fill:#E8F5E9,stroke:#43A047;
    classDef storeNode fill:#FFF3E0,stroke:#FB8C00;
    classDef preprocessNode fill:#FCE4EC,stroke:#D81B60;
    classDef featureNode fill:#F3E5F5,stroke:#8E24AA;
    classDef splitNode fill:#E0F2F1,stroke:#00897B;
    classDef trainNode fill:#FFFDE7,stroke:#FDD835;
    classDef evalNode fill:#E1F5FE,stroke:#039BE5;
    classDef vizNode fill:#F9FBE7,stroke:#C0CA33;
    classDef insightNode fill:#EDE7F6,stroke:#5E35B1;

    %% ======================================================================
    %% Phase 1: Data Acquisition & Storage
    %% ======================================================================
    subgraph "Phase 1: Data Acquisition & Storage"
        direction LR
        A["<div class='nodeIcon'>üíæ</div><div class='nodeTitle'>DATA SOURCE</div><div class='nodeDetail'>NYC Taxi CSV (Kaggle)</div>"]:::dsNode;
        B["<div class='nodeIcon'>üì•</div><div class='nodeTitle'>DATA INGESTION</div><div class='nodeDetail'>Python, Pandas `read_csv`</div>"]:::ingestNode;
        C["<div class='nodeIcon'>üóÑÔ∏è</div><div class='nodeTitle'>DATA STORAGE</div><div class='nodeDetail'>Local Disk (Sim. HDFS)</div>"]:::storeNode;
    end

    %% ======================================================================
    %% Phase 2: Data Preparation
    %% ======================================================================
    subgraph "Phase 2: Data Preparation"
        direction LR
        D["<div class='nodeIcon'>üßπ</div><div class='nodeTitle'>PREPROCESSING</div><div class='nodeDetail'>Cleaning & Transformation</div>"]:::preprocessNode;
        E["<div class='nodeIcon'>‚ú®</div><div class='nodeTitle'>FEATURE ENGINEERING</div><div class='nodeDetail'>`trip_duration`, Time Features</div>"]:::featureNode;
    end

    %% ======================================================================
    %% Phase 3: Model Development & Assessment
    %% ======================================================================
    subgraph "Phase 3: Model Development"
        direction LR
        F{"<div class='nodeIcon'>‚ûó</div><div class='nodeTitle'>DATA SPLITTING</div><div class='nodeDetail'>Train/Test Sets (80/20)</div>"}:::splitNode;
        G["<div class='nodeIcon'>üß†</div><div class='nodeTitle'>MODEL TRAINING</div><div class='nodeDetail'>Random Forest Regressor</div>"]:::trainNode;
        H["<div class='nodeIcon'>‚úÖ</div><div class='nodeTitle'>MODEL EVALUATION</div><div class='nodeDetail'>Metrics: MSE, RMSE, R¬≤</div>"]:::evalNode;
    end

    %% ======================================================================
    %% Phase 4: Insights & Visualization
    %% ======================================================================
    subgraph "Phase 4: Insights & Visualization"
        direction LR
        I["<div class='nodeIcon'>üìä</div><div class='nodeTitle'>VISUALIZATION</div><div class='nodeDetail'>Feature Importance, Predictions vs Actuals</div>"]:::vizNode;
        J["<div class='nodeIcon'>üí°</div><div class='nodeTitle'>ANALYSIS & INSIGHTS</div><div class='nodeDetail'>Key Drivers of Trip Duration</div>"]:::insightNode;
    end

    %% ======================================================================
    %% Workflow Connections (REVISED FOR COMPATIBILITY)
    %% ======================================================================
    A -- "Read" ==> B;
    B -- "Save" ==> C;
    C -- "Load Raw Data" ==> D;
    D -- "Cleaned Data" ==> E;
    E -- "Engineered Features" ==> F;
    
    F -- "Train Data" ==> G;
    F -. "Test Data" .-> H; %% Dotted line remains for secondary flow
    G -- "Trained Model" ==> H;
    
    H -- "Evaluation Results" ==> I;
    I -- "Generate Insights" ==> J;

    %% ======================================================================
    %% Global Link Styling
    %% ======================================================================
    linkStyle default stroke:#616161,stroke-width:2px;
    linkStyle 6 stroke-dasharray: 5 5, stroke:#00897B, stroke-width:2px; %% Style for dotted link
